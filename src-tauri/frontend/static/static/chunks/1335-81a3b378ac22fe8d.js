(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1335],{311:(e,r,s)=>{"use strict";s.d(r,{i:()=>i});var a=s(65453),t=s(34477);let n=(0,t.createServerReference)("7f5060caeb89e0f4820d5363d6874c3785eb2ce4cb",t.callServer,void 0,t.findSourceMapURL,"getTotalUnreadMessages"),i=(0,a.v)(e=>({unreadCount:0,fetchUnreadCount:async r=>{let s=await n(r);s.success&&e({unreadCount:s.count})}}))},30285:(e,r,s)=>{"use strict";s.d(r,{$:()=>d,r:()=>l});var a=s(95155);s(12115);var t=s(99708),n=s(74466),i=s(59434);let l=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:r,variant:s,size:n,asChild:d=!1,...o}=e,c=d?t.DX:"button";return(0,a.jsx)(c,{"data-slot":"button",className:(0,i.cn)(l({variant:s,size:n,className:r})),...o})}},41335:(e,r,s)=>{Promise.resolve().then(s.bind(s,66388))},59434:(e,r,s)=>{"use strict";s.d(r,{cn:()=>n});var a=s(52596),t=s(39688);function n(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return(0,t.QP)((0,a.$)(r))}},62523:(e,r,s)=>{"use strict";s.d(r,{p:()=>n});var a=s(95155);s(12115);var t=s(59434);function n(e){let{className:r,type:s,...n}=e;return(0,a.jsx)("input",{type:s,"data-slot":"input",className:(0,t.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",r),...n})}},66388:(e,r,s)=>{"use strict";s.d(r,{MessageInterface:()=>M});var a=s(95155),t=s(12115),n=s(65453),i=s(34477);let l=(0,i.createServerReference)("7fcacf3cd21af8a39bc036c25dda96b6837ee0265b",i.callServer,void 0,i.findSourceMapURL,"getConversations"),d=(0,i.createServerReference)("7f6a53e972395f3c58e324e5063a337548ea34d3d1",i.callServer,void 0,i.findSourceMapURL,"getMessages"),o=(0,i.createServerReference)("7f06e2d77415781dbdd8212ef40b843b2a1d2d340d",i.callServer,void 0,i.findSourceMapURL,"createMessage");var c=s(56671),u=s(311);let g=(0,n.v)((e,r)=>({conversations:[],messages:[],activeRecipientId:null,activeRecipient:null,isLoading:!1,fetchConversations:async r=>{e({isLoading:!0});try{let s=await l(r);s.success?e({conversations:s.data,isLoading:!1}):(c.oR.error(s.message),e({isLoading:!1,conversations:[]}))}catch(r){console.error("Failed to fetch conversations:",r),e({isLoading:!1,conversations:[]})}},fetchMessages:async(s,a)=>{e({isLoading:!0});try{let t=await d(s,a);t.success?(e({messages:t.data,isLoading:!1}),r().fetchConversations(s),u.i.getState().fetchUnreadCount(s)):(c.oR.error(t.message),e({isLoading:!1,messages:[]}))}catch(r){console.error("Failed to fetch messages:",r),e({isLoading:!1,messages:[]})}},sendMessage:async(s,a,t)=>{let n=await o({sender:s,recipient:a,content:t});if(n.success){let a=n.data;e(e=>({messages:[...e.messages,a]})),r().fetchConversations(s)}else c.oR.error(n.message)},setActiveRecipient:s=>{let a=r().conversations.find(e=>e.user._id===s);e({activeRecipientId:s,activeRecipient:a?a.user:null})}}));var x=s(28883),f=s(51154),v=s(71007),h=s(59434),m=s(47655);function b(e){let{className:r,children:s,...t}=e;return(0,a.jsxs)(m.bL,{"data-slot":"scroll-area",className:(0,h.cn)("relative",r),...t,children:[(0,a.jsx)(m.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:s}),(0,a.jsx)(p,{}),(0,a.jsx)(m.OK,{})]})}function p(e){let{className:r,orientation:s="vertical",...t}=e;return(0,a.jsx)(m.VM,{"data-slot":"scroll-area-scrollbar",orientation:s,className:(0,h.cn)("flex touch-none p-px transition-colors select-none","vertical"===s&&"h-full w-2.5 border-l border-l-transparent","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent",r),...t,children:(0,a.jsx)(m.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function y(){let{conversations:e,isLoading:r,activeRecipientId:s,setActiveRecipient:t}=g();return(0,a.jsxs)("div",{className:"w-1/4 min-w-[250px] border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-l-lg shadow-md",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center",children:[(0,a.jsx)(x.A,{className:"h-6 w-6 mr-2"}),(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Messages"})]}),(0,a.jsx)(b,{className:"h-[calc(100%-64px)]",children:r&&0===e.length?(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(f.A,{className:"h-6 w-6 animate-spin text-gray-500"})}):0===e.length?(0,a.jsx)("div",{className:"p-4 text-center text-gray-500",children:"No conversations found."}):e.map(e=>(0,a.jsxs)("div",{onClick:()=>t(e.user._id),className:(0,h.cn)("flex items-center p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700",s===e.user._id&&"bg-gray-100 dark:bg-gray-700"),children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"font-medium flex items-center",children:[(0,a.jsx)(v.A,{className:"h-4 w-4 mr-2"}),e.user.name,e.user.storeLocation?" (".concat(e.user.storeLocation,")"):""]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.user.role})]}),e.unreadCount>0&&(0,a.jsx)("div",{className:"ml-2 flex items-center justify-center",children:(0,a.jsx)("span",{className:"bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center",children:e.unreadCount})})]},e.user._id))})]})}var j=s(12486);let w=(0,i.createServerReference)("7ffc981da3095404b6b9cc04aa248489a721d31738",i.callServer,void 0,i.findSourceMapURL,"getSessionUser");var N=s(62523),k=s(30285),S=s(81284);function L(e){let{message:r,isSender:s}=e;return r.isSystemMessage?(0,a.jsx)("div",{className:"flex justify-center items-center my-2",children:(0,a.jsxs)("div",{className:"text-center text-xs font-semibold text-yellow-800 dark:text-yellow-200 bg-yellow-100 dark:bg-yellow-900/50 rounded-full py-1.5 px-4 flex items-center gap-2",children:[(0,a.jsx)(S.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:r.content})]})},r._id):(0,a.jsx)("div",{className:(0,h.cn)("flex",s?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:(0,h.cn)("p-3 max-w-sm rounded-lg shadow-md wrap-break-words",s?"bg-linear-to-br from-blue-500 to-blue-700 text-white rounded-br-none":"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-50 rounded-bl-none"),children:[(0,a.jsx)("p",{children:r.content}),(0,a.jsx)("span",{className:"text-xs mt-1 block opacity-70",children:new Date(r.createdAt).toLocaleTimeString()})]})})}function R(){let{user:e}=function(){let[e,r]=(0,t.useState)(null),[s,a]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{(async()=>{a(!0);let e=await w();e.success&&e.data?r(e.data):(console.error(e.message),r(null)),a(!1)})()},[]),{user:e,isLoading:s}}(),r=null==e?void 0:e._id,{messages:s,activeRecipient:n,activeRecipientId:i,sendMessage:l}=g(),[d,o]=(0,t.useState)(""),c=(0,t.useRef)(null);(0,t.useEffect)(()=>{var e;null==(e=c.current)||e.scrollIntoView({behavior:"smooth"})},[s]);let u=()=>{d.trim()&&r&&i&&(l(r,i,d),o(""))};return n?(0,a.jsxs)("div",{className:"flex-1 flex flex-col bg-white dark:bg-gray-800 rounded-r-lg shadow-md",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:n.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Chatting with ",n.role]})]}),(0,a.jsx)(b,{className:"flex-1 p-4",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-4",children:[s.map(e=>(0,a.jsx)(L,{message:e,isSender:e.sender.toString()===r},e._id)),(0,a.jsx)("div",{ref:c})]})}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex items-center space-x-2",children:[(0,a.jsx)(N.p,{placeholder:"Type a message...",value:d,onChange:e=>o(e.target.value),onKeyDown:e=>"Enter"===e.key&&u(),className:"flex-1"}),(0,a.jsx)(k.$,{onClick:u,children:(0,a.jsx)(j.A,{className:"h-4 w-4"})})]})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-6 bg-white dark:bg-gray-800 rounded-r-lg shadow-md",children:(0,a.jsx)("p",{className:"text-lg text-gray-500 dark:text-gray-400",children:"Select a user to start a conversation."})})}function M(e){var r,s;let{session:n}=e,i=null==(r=n.user)?void 0:r.id,l=null==(s=n.user)?void 0:s.role,{fetchConversations:d,fetchMessages:o,activeRecipientId:c,isLoading:u}=g();return((0,t.useEffect)(()=>{i&&d(i)},[i,d]),(0,t.useEffect)(()=>{i&&c&&o(i,c)},[i,c,o]),i)?(0,a.jsxs)("div",{className:"flex flex-col h-full p-6 bg-gray-100 dark:bg-gray-900",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"admin"===l?"Admin Messages":"Messages"}),(0,a.jsxs)("div",{className:"flex flex-1 w-full bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden",children:[(0,a.jsx)(y,{}),(0,a.jsx)(R,{})]})]}):(0,a.jsx)("div",{className:"text-red-500 text-center h-full p-6",children:"Authentication error. Please log in again."})}}}]);