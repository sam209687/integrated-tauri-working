"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5330],{3651:(e,t,r)=>{r.d(t,{BillingSection:()=>_});var a=r(95155),s=r(12115),n=r(45493),l=r(62523),i=r(30285),o=r(22346),c=r(14636),d=r(51154),u=r(27809),x=r(37786),p=r(41049),m=r(65453),h=r(56671),g=r(34477);let f=(0,g.createServerReference)("7f9a5056730c9b8d7bf2ff1bb26913159ea332cf66",g.callServer,void 0,g.findSourceMapURL,"searchCustomersByPhonePrefix"),v=(0,g.createServerReference)("7fa71bfd93cb86e563e194b879f25a51e8520f5b0b",g.callServer,void 0,g.findSourceMapURL,"createCustomer"),b=(0,g.createServerReference)("408d3a4c6c5d4569ad4585263c2773a60624283029",g.callServer,void 0,g.findSourceMapURL,"getInvoiceCountByCustomer"),y=(0,m.v)((e,t)=>({phone:"",name:"",address:"",customer:null,suggestions:[],isCustomerFound:!1,isLoading:!1,visitCount:0,setPhone:t=>e({phone:t}),setName:t=>e({name:t}),setAddress:t=>e({address:t}),searchCustomersByPhonePrefix:async t=>{if(t.length<3)return void e({suggestions:[]});e({isLoading:!0});try{let r=await f(t);r.success&&r.data?e({suggestions:r.data,isLoading:!1}):e({suggestions:[],isLoading:!1})}catch(t){console.error("Error searching customers:",t),e({isLoading:!1}),h.oR.error("Error searching for customer suggestions.")}},selectCustomer:async t=>{let r=await b(t._id);e({phone:t.phone,name:t.name,address:t.address||"",customer:t,isCustomerFound:!0,suggestions:[],visitCount:r.success?r.data:0}),h.oR.success("Customer selected: ".concat(t.name))},createCustomer:async()=>{let{phone:r,name:a,address:s,selectCustomer:n}=t();if(10!==r.length||a.trim().length<2)return void h.oR.error("Please enter a valid 10-digit phone number and name.");e({isLoading:!0});try{let e=await v({phone:r,name:a,address:s});e.success&&e.data?(await n(e.data),h.oR.success(e.message||"Customer added/selected successfully!")):h.oR.error(e.message||"Failed to add customer.")}catch(e){h.oR.error("An unexpected error occurred while adding the customer."),console.error("CREATE CUSTOMer CLIENT ERROR:",e)}finally{e({isLoading:!1})}},resetCustomer:()=>e({phone:"",name:"",address:"",customer:null,isCustomerFound:!1,suggestions:[],visitCount:0})}));var j=r(30051);let N=(0,g.createServerReference)("7f1a56f89921becf53e2f2186820b5c3c919b84798",g.callServer,void 0,g.findSourceMapURL,"getVariantsByMaxPrice"),w=(0,m.v)(e=>({suggestedProducts:[],isLoading:!1,fetchSuggestions:async t=>{if(t<=0)return void e({suggestedProducts:[]});e({isLoading:!0});try{let r=await N(t);r.success?e({suggestedProducts:r.data,isLoading:!1}):e({isLoading:!1})}catch(t){console.error("Error fetching suggestions:",t),e({isLoading:!1})}},clearSuggestions:()=>e({suggestedProducts:[]})})),C=(0,g.createServerReference)("400e6a9fbc28a3bb5b8688003a051bf1d5f57569f2",g.callServer,void 0,g.findSourceMapURL,"createInvoice");var k=r(72897),S=r(59434),R=r(59409);function _(){let{data:e}=(0,n.wV)(),t=(0,s.useRef)(null),{cart:r,clearCart:m,addOecToCart:g,isGstEnabled:f,toggleGst:v,addToCart:b,updateStocksAfterSale:N}=(0,x.x)(),{oecs:_,fetchOecs:L}=(0,p.E)(),{phone:A,name:P,address:E,setPhone:M,setName:z,setAddress:F,searchCustomersByPhonePrefix:O,selectCustomer:q,createCustomer:U,resetCustomer:V,isCustomerFound:I,isLoading:T,customer:$,visitCount:Q,suggestions:G}=y(),{openModal:B}=(0,j.W)(),{suggestedProducts:D,fetchSuggestions:W,clearSuggestions:H,isLoading:K}=w(),[Z,J]=(0,s.useState)(!1),[Y,X]=(0,s.useState)(null),[ee,et]=(0,s.useState)(0);(0,s.useEffect)(()=>{L()},[L]);let[er,ea]=(0,s.useState)(0),[es,en]=(0,s.useState)("cash"),[el,ei]=(0,s.useState)(0),[eo,ec]=(0,s.useState)(!1),[ed,eu]=(0,s.useState)(!1),ex=(0,k.d)(A,300),ep=(0,s.useMemo)(()=>r.reduce((e,t)=>e+t.price*t.quantity,0),[r]),em=(0,s.useMemo)(()=>f?r.reduce((e,t)=>{var r,a;let s=null!=(a=null==(r=t.product.tax)?void 0:r.gst)?a:0;return e+t.price*t.quantity*s/100},0):0,[r,f]),eh=(0,s.useMemo)(()=>{let e=ep-er-10*!!ed+em;return e>0?e:0},[ep,er,ed,em]),eg=(0,s.useMemo)(()=>"cash"!==es||el<eh?0:el-eh,[el,eh,es]),ef=(0,k.d)(eg,750);(0,s.useEffect)(()=>{ex.length>=3&&ex.length<10?O(ex):(ex.length<3||10===ex.length)&&y.setState({suggestions:[]})},[ex,O]),(0,s.useEffect)(()=>{0===A.length?V():A.length<10&&I&&y.setState({isCustomerFound:!1,customer:null,name:"",address:"",visitCount:0})},[A,V,I]),(0,s.useEffect)(()=>{ef>0?W(ef):H()},[ef,W,H]);let ev=(0,s.useMemo)(()=>_.find(e=>e._id===Y),[_,Y]),eb=()=>{m(),V(),H(),ea(0),ei(0),en("cash"),ec(!1),eu(!1)},ey=async()=>{var t;if(!(null==e||null==(t=e.user)?void 0:t.id))return void h.oR.error("User not logged in. Cannot create invoice.");if(!I||!$)return 10===A.length&&P.trim().length>1?void h.oR.error("Please click the 'Add' button to confirm the new customer first."):void h.oR.error("Please add or select a customer before printing.");if(0===r.length)return void h.oR.error("Cannot print an empty cart.");J(!0);let a={billedById:e.user.id,customerId:$._id,items:r.map(e=>{var t,r,a,s,n;return{variantId:e._id,name:e.product.productName,price:e.price,quantity:e.quantity,mrp:null!=(a=e.mrp)?a:0,gstRate:f&&null!=(s=null==(t=e.product.tax)?void 0:t.gst)?s:0,hsn:f&&null!=(n=null==(r=e.product.tax)?void 0:r.hsn)?n:""}}),subtotal:ep,discount:er,packingChargeDiscount:10*!!ed,gstAmount:em,totalPayable:eh,paymentMethod:es},s=await C(a);if(s.success&&s.data){h.oR.success("Invoice saved successfully!"),B(s.data);let e=r.filter(e=>"variant"===e.type).map(e=>({variantId:e._id,quantity:e.quantity}));await N(e);let{fetchProducts:t}=x.x.getState();await t(),eb()}else h.oR.error(s.message||"Failed to save invoice.");J(!1)};return(0,a.jsxs)("div",{className:"bg-gray-900 p-4 rounded-lg text-gray-200 h-full flex flex-col",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold",children:["Cart (",r.length,")"]}),(0,a.jsxs)("span",{className:"text-2xl font-bold",children:["₹ ",eh.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"p-3 rounded-lg mt-2",children:[(0,a.jsx)("h4",{className:"font-semibold mb-1 text-sm",children:"Customer Details"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsxs)(c.AM,{open:G.length>0&&A.length>=3&&A.length<10,modal:!1,onOpenChange:e=>{},children:[(0,a.jsx)(c.Wv,{asChild:!0,children:(0,a.jsx)(l.p,{ref:t,placeholder:"Phone Number",className:"h-8 bg-gray-700 border-none text-white",type:"tel",value:A,onChange:e=>{M(e.target.value.replace(/\D/g,"").slice(0,10))},maxLength:10})}),(0,a.jsxs)(c.hl,{className:"w-[300px] p-0 bg-gray-800 border-gray-700 max-h-60 overflow-y-auto z-50",children:[T&&(0,a.jsx)("div",{className:"p-2 flex items-center justify-center",children:(0,a.jsx)(d.A,{className:"animate-spin h-4 w-4"})}),!T&&0===G.length&&A.length>=3&&(0,a.jsx)("p",{className:"p-2 text-xs text-gray-400",children:"No matches found."}),G.map(e=>(0,a.jsxs)("div",{className:"p-2 border-b border-gray-700 hover:bg-gray-700 cursor-pointer text-xs",onClick:()=>{var r;q(e),y.setState({suggestions:[]}),null==(r=t.current)||r.focus()},children:[(0,a.jsx)("span",{className:"font-bold text-white",children:e.phone}),(0,a.jsx)("span",{className:"ml-2 text-gray-400",children:e.name})]},e._id))]})]}),T&&(0,a.jsx)(d.A,{className:"animate-spin h-4 w-4 absolute right-2 top-2 text-gray-400"})]}),(0,a.jsx)(l.p,{placeholder:"Name",className:"h-8 bg-gray-700 border-none text-white flex-1",value:P,onChange:e=>z(e.target.value),readOnly:I}),(0,a.jsx)(l.p,{placeholder:"Address (Optional)",className:"h-8 bg-gray-700 border-none text-white flex-1",value:E,onChange:e=>F(e.target.value)}),!I&&10===A.length&&P.trim().length>1&&(0,a.jsx)(i.$,{onClick:U,variant:"outline",className:"h-8 px-2 py-1 text-black bg-yellow-500 hover:bg-yellow-600 font-semibold text-xs",disabled:T,children:T?(0,a.jsx)(d.A,{className:"animate-spin h-4 w-4"}):"Add"})]}),I&&Q>0&&(0,a.jsxs)("div",{className:"bg-gray-800 text-center text-xs text-yellow-400 p-1 rounded-md",children:["Customer has made ",Q," previous purchase(s)."]})]})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-4 no-scrollbar",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsx)("span",{children:"Total Items:"}),(0,a.jsx)("span",{className:"font-semibold",children:r.length})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsxs)("span",{className:"font-semibold",children:["₹ ",ep.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsx)("span",{children:"Discount (₹):"}),(0,a.jsx)(l.p,{type:"number",placeholder:"0",className:"h-8 w-20 bg-gray-800 border-none text-white text-xs text-right [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",value:er||"",onChange:e=>ea(e.target.valueAsNumber||0)})]}),f&&(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm text-green-400",children:[(0,a.jsx)("span",{children:"GST Amount:"}),(0,a.jsxs)("span",{className:"font-semibold",children:["₹ ",em.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-center pt-2",children:[(0,a.jsx)(i.$,{onClick:()=>en("cash"),className:(0,S.cn)("flex-1 font-semibold","cash"===es?"bg-green-500 hover:bg-green-600 text-black":"bg-gray-700 hover:bg-gray-600 text-white"),children:"Cash"}),(0,a.jsx)(i.$,{onClick:()=>en("upi"),className:(0,S.cn)("flex-1 font-semibold","upi"===es?"bg-blue-500 hover:bg-blue-600 text-black":"bg-gray-700 hover:bg-gray-600 text-white"),children:"UPI"}),(0,a.jsx)(i.$,{onClick:()=>en("card"),className:(0,S.cn)("flex-1 font-semibold","card"===es?"bg-purple-500 hover:bg-purple-600 text-black":"bg-gray-700 hover:bg-gray-600 text-white"),children:"Card"})]}),"cash"===es&&(0,a.jsxs)("div",{className:"space-y-4 pt-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsx)("span",{children:"Paid Amount:"}),(0,a.jsx)(l.p,{type:"number",placeholder:"0",className:"h-8 w-20 bg-gray-800 border-none text-white text-xs text-right [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",value:el||"",onChange:e=>ei(e.target.valueAsNumber||0)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsx)("span",{children:"Change:"}),(0,a.jsxs)(c.AM,{children:[(0,a.jsx)(c.Wv,{asChild:!0,children:(0,a.jsx)(l.p,{readOnly:!0,value:eg.toFixed(2),className:"h-8 w-20 bg-gray-800 border-yellow-500 text-yellow-400 font-bold text-xs text-right cursor-pointer"})}),(0,a.jsxs)(c.hl,{className:"w-80 bg-gray-800 border-gray-700 text-white",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium leading-none",children:"Product Suggestions"}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Products you can buy with the change amount."})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[K&&(0,a.jsx)(d.A,{className:"animate-spin"}),0===D.length&&!K&&(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"No products found."}),D.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs p-2 rounded-md hover:bg-gray-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:e.product.productName}),(0,a.jsxs)("div",{className:"text-gray-400",children:[e.variantVolume," ",e.unit.name]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"font-bold",children:["₹",e.price.toFixed(2)]}),(0,a.jsx)(i.$,{size:"icon",className:"h-6 w-6 bg-yellow-500 hover:bg-yellow-600",onClick:()=>b(e),children:(0,a.jsx)(u.A,{className:"h-4 w-4 text-black"})})]})]},e._id))]})]})]})]})]}),(0,a.jsx)(o.Separator,{className:"bg-gray-700"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-orange-600 bg-gray-600",checked:eo,onChange:e=>ec(e.target.checked)}),(0,a.jsx)("span",{className:"text-sm",children:"Oil Expelling Charges"})]}),eo&&(0,a.jsxs)("div",{className:"p-3 rounded-lg flex flex-col gap-2 border border-gray-700",children:[(0,a.jsxs)(R.l6,{onValueChange:X,value:Y||"",children:[(0,a.jsx)(R.bq,{className:"h-8 bg-gray-700 border-none text-white text-xs",children:(0,a.jsx)(R.yv,{placeholder:"Select Product..."})}),(0,a.jsx)(R.gC,{children:_.map(e=>(0,a.jsxs)(R.eb,{value:e._id,children:[e.product.productName," (",e.product.productCode,")"]},e._id))})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.p,{type:"number",placeholder:"Qty",className:"h-8 bg-gray-700 border-none text-white text-xs [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",value:ee||"",onChange:e=>et(e.target.valueAsNumber||0)}),(0,a.jsx)(l.p,{readOnly:!0,placeholder:"Charges",className:"h-8 bg-gray-700 border-none text-white text-xs",value:ev?"₹ ".concat(ev.oilExpellingCharges.toFixed(2)):"Charges"}),(0,a.jsx)(i.$,{size:"sm",onClick:()=>{if(!ev||!ee||ee<=0)return void h.oR.error("Please select a product and enter a valid quantity.");g({productName:"Oil Expelling: ".concat(ev.product.productName),quantity:ee,price:ev.oilExpellingCharges}),h.oR.success("OEC added to cart."),X(null),et(0)},className:"h-8 bg-blue-500 hover:bg-blue-600 text-black",children:"Add"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-orange-600 bg-gray-600",checked:ed,onChange:e=>eu(e.target.checked)}),(0,a.jsx)("span",{className:"text-sm",children:"Exclude Packing Charges"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-orange-600 bg-gray-600",checked:f,onChange:v}),(0,a.jsx)("span",{className:"text-sm",children:"Enable GST"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(o.Separator,{className:"bg-gray-700 my-4"}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("span",{className:"text-lg font-bold",children:"Total Payable:"}),(0,a.jsxs)("span",{className:"text-lg font-bold",children:["₹ ",eh.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,a.jsxs)(i.$,{onClick:ey,className:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-black font-semibold",disabled:Z,children:[Z?(0,a.jsx)(d.A,{className:"animate-spin h-4 w-4 mr-2"}):null,Z?"Saving...":"Print Bill"]}),(0,a.jsx)(i.$,{onClick:eb,className:"flex-1 bg-red-500 hover:bg-red-600 text-black font-semibold",children:"Clear"})]})]})]})}},4089:(e,t,r)=>{r.d(t,{Searchbar:()=>x});var a=r(95155),s=r(12115),n=r(62523),l=r(30285),i=r(37786),o=r(55028),c=r(54416);let d=(0,r(19946).A)("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),u=(0,o.default)(()=>r.e(2352).then(r.bind(r,12352)).then(e=>e.Scanner),{loadableGenerated:{webpack:()=>[12352]},ssr:!1});function x(){let{products:e,searchQuery:t,setSearchQuery:r,isLoading:o,addToCart:x,fetchProducts:p}=(0,i.x)(),m=(0,s.useRef)(null),[h,g]=(0,s.useState)(!1);(0,s.useEffect)(()=>{p()},[p]),(0,s.useEffect)(()=>{let e=e=>{if(e.ctrlKey&&e.altKey&&"s"===e.key){var t;e.preventDefault(),null==(t=m.current)||t.focus()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]);let f=t=>{if(t){try{let r=JSON.parse(t),a=e.find(e=>e._id===r.variantId||e.product._id===r.productId);a?x(a):alert("❌ Product not found for scanned QR code.")}catch(a){let r=e.find(e=>e._id===t||e.product._id===t);r?x(r):alert("❌ Invalid QR or product not found.")}g(!1)}},v=(0,s.useMemo)(()=>{if(!Array.isArray(e))return[];if(!t)return e.filter(e=>e&&e.product);let r=t.toLowerCase();return e.filter(e=>{var t,a,s,n,l,i,o,c,d;if(!e||!e.product)return!1;let u=(null==(a=e.product.brand)||null==(t=a.name)?void 0:t.toLowerCase())||"",x=(null==(n=e.product.category)||null==(s=n.name)?void 0:s.toLowerCase())||"",p=(null==(l=e.variantColor)?void 0:l.toLowerCase())||"",m=(null==(i=e.product.productCode)?void 0:i.toLowerCase())||"",h=(null==(o=e.product.productName)?void 0:o.toLowerCase())||"",g=(null==(d=e.unit)||null==(c=d.name)?void 0:c.toLowerCase())||"";return m.includes(r)||h.includes(r)||u.includes(r)||x.includes(r)||p.includes(r)||g.includes(r)||e.price.toString().includes(r)||e.variantVolume.toString().includes(r)})},[e,t]);return(0,a.jsxs)("div",{className:"flex flex-col h-full w-full bg-gray-900 rounded-lg p-4 relative",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,a.jsx)(n.p,{ref:m,placeholder:"Search by product, code, brand, price...",className:"h-10 bg-gray-800 border-none text-white focus:ring-2 focus:ring-yellow-500 flex-1",value:t,onChange:e=>r(e.target.value)}),(0,a.jsx)(l.$,{size:"icon",variant:"outline",className:"bg-gray-800 hover:bg-gray-700 text-yellow-400",onClick:()=>g(e=>!e),children:h?(0,a.jsx)(c.A,{className:"h-4 w-4"}):(0,a.jsx)(d,{className:"h-4 w-4"})})]}),h&&(0,a.jsxs)("div",{className:"absolute inset-0 bg-black/80 z-50 flex flex-col items-center justify-center p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"w-full max-w-sm rounded-lg overflow-hidden border border-gray-700 bg-gray-950 shadow-lg",children:(0,a.jsx)(u,{onScan:e=>{var t;let r=null==e||null==(t=e[0])?void 0:t.rawValue;r&&f(r)},onError:e=>{console.error("QR Scanner Error:",e)},constraints:{facingMode:"environment"},styles:{container:{width:"100%"}}})}),(0,a.jsx)(l.$,{variant:"secondary",className:"mt-4 text-white border-gray-700 hover:bg-gray-800",onClick:()=>g(!1),children:"Close Scanner"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto pr-2",children:o?(0,a.jsx)("div",{className:"text-center text-gray-400 py-8",children:"Loading products..."}):0===e.length?(0,a.jsx)("div",{className:"text-center text-gray-400 py-8",children:"No products found or error fetching products."}):(0,a.jsxs)("table",{className:"w-full text-sm text-gray-300",children:[(0,a.jsx)("thead",{className:"sticky top-0 bg-gray-900 z-10",children:(0,a.jsxs)("tr",{className:"border-b border-gray-700 text-left",children:[(0,a.jsx)("th",{className:"py-2 px-1",children:"Product"}),(0,a.jsx)("th",{className:"py-2 px-1 text-right",children:"Price"}),(0,a.jsx)("th",{className:"py-2 px-1 text-center",children:"Stock"}),(0,a.jsx)("th",{className:"py-2 px-1 text-center",children:"Action"})]})}),(0,a.jsx)("tbody",{children:v.map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-b border-gray-800 hover:bg-gray-800 transition-all duration-200 hover:scale-[1.01]",children:[(0,a.jsxs)("td",{className:"py-2 px-1",children:[(0,a.jsx)("div",{className:"font-medium text-gray-100",children:e.product.productCode}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:e.product.productName}),(0,a.jsxs)("div",{className:"text-xs text-gray-400 font-semibold",children:[e.variantVolume," ",e.unit.name]}),e.variantColor&&(0,a.jsx)("div",{className:"text-xs text-gray-400 font-semibold",children:e.variantColor})]}),(0,a.jsxs)("td",{className:"py-2 px-1 text-right font-bold text-gray-100",children:["₹ ",e.price.toFixed(2)]}),(0,a.jsx)("td",{className:"py-2 px-1 text-center text-gray-400",children:null!=(t=e.stockQuantity)?t:"—"}),(0,a.jsx)("td",{className:"py-2 px-1 text-center",children:(0,a.jsx)(l.$,{size:"sm",className:"h-7 px-2 py-1 bg-yellow-500 hover:bg-yellow-600 text-black font-semibold text-xs",onClick:()=>x(e),children:"Add"})})]},e._id)})})]})})]})}},6654:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return s}});let a=r(12115);function s(e,t){let r=(0,a.useRef)(null),s=(0,a.useRef)(null);return(0,a.useCallback)(a=>{if(null===a){let e=r.current;e&&(r.current=null,e());let t=s.current;t&&(s.current=null,t())}else e&&(r.current=n(e,a)),t&&(s.current=n(t,a))},[e,t])}function n(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},14636:(e,t,r)=>{r.d(t,{AM:()=>l,Wv:()=>i,hl:()=>o});var a=r(95155);r(12115);var s=r(20547),n=r(59434);function l(e){let{...t}=e;return(0,a.jsx)(s.bL,{"data-slot":"popover",...t})}function i(e){let{...t}=e;return(0,a.jsx)(s.l9,{"data-slot":"popover-trigger",...t})}function o(e){let{className:t,align:r="center",sideOffset:l=4,...i}=e;return(0,a.jsx)(s.ZL,{children:(0,a.jsx)(s.UC,{"data-slot":"popover-content",align:r,sideOffset:l,className:(0,n.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...i})})}},27809:(e,t,r)=>{r.d(t,{A:()=>a});let a=(0,r(19946).A)("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},37786:(e,t,r)=>{r.d(t,{x:()=>h});var a,s=r(65453),n=r(34477);let l=(0,n.createServerReference)("0036feb188168c5b819d7768f28732dd49e88df5ba",n.callServer,void 0,n.findSourceMapURL,"getVariantsForPOS");var i=new Uint8Array(16);let o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var c=[],d=0;d<256;++d)c.push((d+256).toString(16).substr(1));let u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!("string"==typeof r&&o.test(r)))throw TypeError("Stringified UUID is invalid");return r},x=function(e,t,r){var s=(e=e||{}).random||(e.rng||function(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(i)})();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=s[n];return t}return u(s)};var p=r(56671);let m=(0,n.createServerReference)("40ec49d0485e3fdf71f98b8a36d02d6ffc1fd04d1d",n.callServer,void 0,n.findSourceMapURL,"updateStockQuantitiesInDB"),h=(0,s.v)((e,t)=>({products:[],cart:[],searchQuery:"",isLoading:!1,isGstEnabled:!1,setSearchQuery:t=>e({searchQuery:t}),fetchProducts:async()=>{e({isLoading:!0});try{let{success:t,data:r,message:a}=await l();if(!t||!(null==r?void 0:r.length)){console.warn("No products or variants found:",a),e({products:[],isLoading:!1});return}e({products:r,isLoading:!1})}catch(t){console.error("❌ Error fetching products:",t),e({products:[],isLoading:!1})}},addToCart:r=>{var a;let s=t().cart.find(e=>e._id===r._id),n=null!=(a=r.stockQuantity)?a:0;if(n<=0)return void p.oR.error("".concat(r.product.productName," is out of stock!"));if(s){if(s.quantity+1>n)return void p.oR.error("Not enough stock available!");t().updateCartQuantity(r._id,s.quantity+1)}else e(e=>({cart:[...e.cart,{_id:r._id,product:r.product,quantity:1,price:r.price,mrp:r.mrp,variantVolume:r.variantVolume,unit:r.unit,variantColor:r.variantColor,type:"variant"}]}))},addOecToCart:t=>{let r={_id:x(),product:{productName:t.productName},price:t.price,quantity:t.quantity,type:"oec"};e(e=>({cart:[...e.cart,r]}))},updateCartQuantity:(r,a)=>{var s;if(a<=0)return void t().removeFromCart(r);let n=t().products.find(e=>e._id===r);if(n&&a>(null!=(s=n.stockQuantity)?s:0))return void p.oR.error("Not enough stock available!");e(e=>({cart:e.cart.map(e=>e._id===r?{...e,quantity:a}:e)}))},removeFromCart:t=>{e(e=>({cart:e.cart.filter(e=>e._id!==t)}))},clearCart:()=>e({cart:[],isGstEnabled:!1}),toggleGst:()=>e(e=>({isGstEnabled:!e.isGstEnabled})),updateStocksAfterSale:async e=>{if(0!==e.length)try{let t=await m(e);t.success?console.log(t.message):p.oR.error(t.message||"Failed to update stocks in the database.")}catch(e){console.error("❌ Error updating stocks:",e),p.oR.error("An unexpected error occurred during stock update.")}},checkout:async()=>{}}))},41049:(e,t,r)=>{r.d(t,{E:()=>o});var a=r(65453),s=r(34477);let n=(0,s.createServerReference)("7f3a36380c0100b75354dc7f37b8c24ca15bc6cfdc",s.callServer,void 0,s.findSourceMapURL,"getOecs"),l=(0,s.createServerReference)("7ffce4cca7f46d8656a217fbc23e9a52fdf936f2b1",s.callServer,void 0,s.findSourceMapURL,"getProductsForOec");var i=r(56671);let o=(0,a.v)(e=>({oecs:[],products:[],isLoading:!1,fetchOecs:async()=>{e({isLoading:!0});try{let t=await n();t.success?e({oecs:t.data,isLoading:!1}):(i.oR.error(t.message||"Failed to fetch OECs."),e({isLoading:!1}))}catch(t){console.error("Failed to fetch OECs:",t),i.oR.error("Failed to fetch OECs due to an unexpected error."),e({isLoading:!1})}},fetchProducts:async()=>{e({isLoading:!0});try{let t=await l();t.success?e({products:t.data,isLoading:!1}):(i.oR.error(t.message||"Failed to fetch products."),e({isLoading:!1}))}catch(t){console.error("Failed to fetch products:",t),i.oR.error("Failed to fetch products due to an unexpected error."),e({isLoading:!1})}}}))},49825:(e,t,r)=>{r.d(t,{LiveCart:()=>c});var a=r(95155),s=r(37786);let n=(0,r(19946).A)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var l=r(84616),i=r(30285),o=r(52900);function c(){let{cart:e,updateCartQuantity:t,removeFromCart:r,isGstEnabled:c}=(0,s.x)(),d=c?"grid-cols-[2fr_1fr_1fr_1fr_1fr_1fr_1fr_1fr]":"grid-cols-[2fr_1fr_1fr_1fr_1fr_1fr_1fr]";return(0,a.jsxs)("div",{className:"flex flex-col h-[330px] w-full bg-gray-900 rounded-lg p-4 overflow-hidden",children:[(0,a.jsxs)("div",{className:"text-gray-400 text-sm font-semibold uppercase border-b border-gray-700 pb-2 mb-2 grid ".concat(d," sticky top-0 bg-gray-900 z-30"),children:[(0,a.jsx)("div",{className:"text-left",children:"Product"}),(0,a.jsx)("div",{className:"text-center",children:"Price"}),(0,a.jsx)("div",{className:"text-center",children:"MRP"}),(0,a.jsx)("div",{className:"text-center",children:"Disc. %"}),c&&(0,a.jsx)("div",{className:"text-center",children:"GST"}),(0,a.jsx)("div",{className:"text-center",children:"Quantity"}),(0,a.jsx)("div",{className:"text-center",children:"Total"}),(0,a.jsx)("div",{className:"text-center",children:"Action"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto no-scrollbar space-y-2 pr-1 pb-4",children:e.length>0?e.map(e=>{var s,u;let x=0;e.mrp&&e.price&&e.mrp>e.price&&(x=(e.mrp-e.price)/e.mrp*100);let p=c?e.price*e.quantity*(null!=(u=null==(s=e.product.tax)?void 0:s.gst)?u:0)/100:0;return(0,a.jsxs)(o.P.div,{className:"grid ".concat(d," items-center border border-transparent hover:border-gray-700 py-3 px-3 rounded-md bg-gray-800/30 hover:bg-gray-800/70 transition-colors duration-150"),initial:{opacity:.95},animate:{opacity:1},transition:{duration:.2},style:{pointerEvents:"auto"},children:[(0,a.jsxs)("div",{className:"flex flex-col min-w-0 pl-1",children:[(0,a.jsx)("span",{className:"font-medium text-gray-100 truncate",children:e.product.productName}),"variant"===e.type&&(0,a.jsx)("span",{className:"text-xs text-gray-400 truncate",children:e.product.productCode})]}),(0,a.jsxs)("div",{className:"text-center font-bold text-gray-100",children:["₹ ",e.price.toFixed(2)]}),(0,a.jsx)("div",{className:"text-center text-gray-400",children:e.mrp?"₹ ".concat(e.mrp.toFixed(2)):"N/A"}),(0,a.jsx)("div",{className:"text-center text-green-400",children:x>0?"".concat(x.toFixed(1),"%"):"0%"}),c&&(0,a.jsx)("div",{className:"text-center text-yellow-400",children:p>0?"₹ ".concat(p.toFixed(2)):"N/A"}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-1",children:[(0,a.jsx)(i.$,{size:"sm",variant:"outline",className:"h-6 w-6 text-white",onClick:r=>{r.stopPropagation(),t(e._id,e.quantity-1)},disabled:"oec"===e.type,children:(0,a.jsx)(n,{className:"h-3 w-3"})}),(0,a.jsx)("span",{className:"w-6 text-center text-sm",children:e.quantity}),(0,a.jsx)(i.$,{size:"sm",variant:"outline",className:"h-6 w-6 text-white",onClick:r=>{r.stopPropagation(),t(e._id,e.quantity+1)},disabled:"oec"===e.type,children:(0,a.jsx)(l.A,{className:"h-3 w-3"})})]}),(0,a.jsxs)("div",{className:"text-center font-bold text-gray-100",children:["₹ ",(e.price*e.quantity).toFixed(2)]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(i.$,{size:"sm",variant:"destructive",className:"h-6 px-2 text-xs",onClick:t=>{t.stopPropagation(),r(e._id)},children:"Remove"})})]},e._id)}):(0,a.jsx)("div",{className:"text-center text-gray-400 py-8",children:"Your cart is empty. Add products to get started."})})]})}},59409:(e,t,r)=>{r.d(t,{bq:()=>u,eb:()=>p,gC:()=>x,l6:()=>c,yv:()=>d});var a=r(95155);r(12115);var s=r(31992),n=r(66474),l=r(5196),i=r(47863),o=r(59434);function c(e){let{...t}=e;return(0,a.jsx)(s.bL,{"data-slot":"select",...t})}function d(e){let{...t}=e;return(0,a.jsx)(s.WT,{"data-slot":"select-value",...t})}function u(e){let{className:t,size:r="default",children:l,...i}=e;return(0,a.jsxs)(s.l9,{"data-slot":"select-trigger","data-size":r,className:(0,o.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...i,children:[l,(0,a.jsx)(s.In,{asChild:!0,children:(0,a.jsx)(n.A,{className:"size-4 opacity-50"})})]})}function x(e){let{className:t,children:r,position:n="popper",...l}=e;return(0,a.jsx)(s.ZL,{children:(0,a.jsxs)(s.UC,{"data-slot":"select-content",className:(0,o.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...l,children:[(0,a.jsx)(m,{}),(0,a.jsx)(s.LM,{className:(0,o.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:r}),(0,a.jsx)(h,{})]})})}function p(e){let{className:t,children:r,...n}=e;return(0,a.jsxs)(s.q7,{"data-slot":"select-item",className:(0,o.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...n,children:[(0,a.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(s.VF,{children:(0,a.jsx)(l.A,{className:"size-4"})})}),(0,a.jsx)(s.p4,{children:r})]})}function m(e){let{className:t,...r}=e;return(0,a.jsx)(s.PP,{"data-slot":"select-scroll-up-button",className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(i.A,{className:"size-4"})})}function h(e){let{className:t,...r}=e;return(0,a.jsx)(s.wn,{"data-slot":"select-scroll-down-button",className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(n.A,{className:"size-4"})})}},62523:(e,t,r)=>{r.d(t,{p:()=>n});var a=r(95155);r(12115);var s=r(59434);function n(e){let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,"data-slot":"input",className:(0,s.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}},72897:(e,t,r)=>{r.d(t,{d:()=>s});var a=r(12115);function s(e,t){let[r,s]=(0,a.useState)(e);return(0,a.useEffect)(()=>{let r=setTimeout(()=>s(e),t||500);return()=>{clearTimeout(r)}},[e,t]),r}},84616:(e,t,r)=>{r.d(t,{A:()=>a});let a=(0,r(19946).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])}}]);